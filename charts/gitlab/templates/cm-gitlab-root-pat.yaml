kind: ConfigMap
metadata:
  name:  cm-create-root-pat
  annotations:
    argocd.argoproj.io/sync-wave: "3"
apiVersion: v1
data:
  create-root-pat.sh: |
    #!/bin/bash
    set -e
    
    echo -n "token = User.find(1).personal_access_tokens.create(name: 'apitoken', impersonation: false, scopes: [:api]); token.save!; token_value = token.token; File.open('/tmp/root.pat', 'w', 0600) { |file| file.write(token_value) }" | ./bin/rails console
    personal_access_token=$(cat /tmp/root.pat)
    oc create secret generic root-user-personal-token --from-literal=token=$personal_access_token -n {{ $.Release.Namespace }}
